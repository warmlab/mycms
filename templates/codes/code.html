{% extends "codes/base.html" %}
{% block style %}
<link href="/static/codes/css/code.css" rel="stylesheet" type="text/css"/>
{% endblock %}
{% load url from future %}
{% block script %}
<script type="text/javascript" language="javascript">
function add_comment() {
	comment_holder = $("#comment_holder");
	$.post("{% url 'code_comment' code.slug %}", {
			author: $("#id_author").val(),
			title: $("#id_title").val(),
			email: $("#id_email").val(),
			body: $("#id_body").val(),
			'csrfmiddlewaretoken': '{{ csrf_token }}'
		}, 
		function(data){
			jQuery.each(data, function(index, comment) {
			comment_holder.append('<div class="comment">'
	        + '<div style="padding-left:2px;font-size:100%;color:#191970">'
			+ comment.fields.author
			+ '<span class="time"> - '
			+ new Date(comment.fields.created)
			+ '</span></div>'
	        + '<div style="padding-left:2px;font-size:90%;color:#708090;"><p>'
			+ comment.fields.body.replace(/(\r\n|\n\r|\r|\n)/g, '<br/>')
			+ '</p></div></div><br/>');
			});
		}
	);
	{% comment %}
	comment_holder = $("#comment_holder");
	most_recent = comment.finde("div:first");
	$.getJSON("{% url 'code_comment' code.id %}",
		function(data) {
			jQuery.each(data, function() {
				comment_holder.prepend('<div class="comment">'
	        + '<div style="padding-left:2px;font-size:100%;color:#191970">'
			+ {{ comment.author }}
			+ '<span class="time"> - '
			+ {{ comment.created }}
			+ '</span></div>'
	        + '<div style="padding-left:2px;font-size:90%;color:#708090;">'
			+ {{ comment.body|linebreaks }}'
			+ '</div></div><br/>');
			});
		}
	);
	{% endcomment %}
}
</script>
{% endblock %}

{% block content %}
	<div class="content">
	<h1><span class="color_h1">{{ code.title }}</span></h1>
	<div><span class="time">{{ code.created }}</span></div>
	<hr/>
	<div>{{ code.html_body|safe }}</div>
	</div>
	<br/>

{% if comments %}
    <h2><span class="color_h1">Comments:</span></h2>
{% endif %}
<div id="comment_holder">
{% for comment in comments %}
    <div class="comment">
	        <div style="padding-left:2px;font-size:100%;color:#191970">{{ comment.author }}<span class="time"> - {{ comment.created }}</span></div>
	        <div style="padding-left:2px;font-size:90%;color:#708090;">{{ comment.body|linebreaks }}</div>
    </div>
	<br/>
{% endfor %}
</div>

<div style="font-size:160%;color:#98bf21;">Add a comment:</div>
<!-- Comment form  -->
<div style="border-style:dashed;border-width:1px;border-radius:5px;border-color:#98bf21;">
{#<form action="{% url 'code_comment' code.id %}" method="POST">#}
	<table>
		<tr><td>Name:</td><td>{{ form.author }}</td></tr>
		<tr><td>Email:</td><td>{{ form.email }}</td></tr>
		<tr><td>Title:</td><td>{{ form.title }}</td></tr>
	    <tr><td colspan="2">{{ form.body|linebreaks }}</td></tr>
		{#<tr><td colspan="2" style="text-align:right;"><input class="button" type="submit" value="Submit"/></td></tr>#}
		<tr><td colspan="2" style="text-align:right;"><input class="button" type="button" value="Submit" onclick="add_comment()"/></td></tr>
    </table>
{#</form>#}
</div>
{% endblock %}
